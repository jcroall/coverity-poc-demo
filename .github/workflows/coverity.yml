name: Coverity POC with GitHub-hosted runner
on:
  push:
    branches: [ master, main ]

  pull_request:
    branches: [ master, main ]

jobs:
  build:
    runs-on: ubuntu-latest

    env:
      COVERITY_CHECKERS: --webapp-security
      COVERITY_URL: ${{ secrets.COVERITY_URL }}
      COV_USER: ${{ secrets.COVERITY_USER }}
      COVERITY_PASSPHRASE: ${{ secrets.COVERITY_PASSPHRASE }}

    steps:
      - uses: actions/checkout@v2

      - name: Get Coverity bits
        shell: bash
        run: time curl https://github.com/synopsys-sig-community/synopsys-github-templates/releases/download/v0.0.1/cov-analysis-linux64-2021.12.1-poc-nolicense.tgz

      - uses: synopsys-sig-community/synopsys-github-templates/coverity-poc-wrapper@v0.0.1
        with:
          coverity-url: ${{ secrets.COVERITY_URL }}
          coverity-user: ${{ secrets.COVERITY_USER }}
          coverity-passphrase: ${{ secrets.COVERITY_PASSPHRASE }}
          coverity-license: ${{ secrets.COVERITY_LICENSE }}
          coverity-project-name: ${{ github.event.repository.name }}
          coverity-checker-options: --webapp-security
          create-stream-and-project: true
          security-gate-view-name: "High and Medium Severity"
          github-token: ${{ secrets.GITHUB_TOKEN }}
